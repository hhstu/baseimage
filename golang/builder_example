FROM basefly/golang:1.16.4-alpine AS builder
WORKDIR /build
### copy your code
COPY . .
RUN VERSION=$(./git.sh) && \
    echo  $VERSION && \
    go build -ldflags="-s -w -X github.com/xxx/xxx/pkg.Version=${VERSION}"  -o xxx ./cmd && \
    upx ./xxx

FROM basefly/alpine:v3.13.5
WORKDIR /app
COPY --from=builder /build/ccs-core ccs-core
CMD ./xxx